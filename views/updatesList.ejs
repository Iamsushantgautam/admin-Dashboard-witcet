<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Updates</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<%- include('partials/navbar') %>

<div class="main-content">

  <div class="container py-5">
    <h2 class="text-center text-primary mb-5">Updates</h2>

    <div class="d-flex justify-content-between align-items-center mb-4">
      <p class="mb-0">Manage your updates here.</p>
      <a href="/updates/add" class="btn btn-primary">+ Add Update</a>
    </div>

    <% if (updates.length === 0) { %>
      <div class="alert alert-info text-center">
        No updates added yet. Click "Add Update" to get started.
      </div>
    <% } else { %>
      <div class="row">
        <% updates.forEach(update => { %>
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title"><%= update.title %></h5>
                <p class="card-text"><%= update.description %></p>
                <p class="text-muted"><strong>Date:</strong> <%= new Date(update.date).toLocaleDateString() %></p>
                <p class="text-muted"><strong>Time:</strong> <%= update.time %></p>
                <p class="mb-2">
                  <span class="badge <%= update.isActive ? 'bg-success' : 'bg-secondary' %>">
                    <%= update.isActive ? 'ðŸŸ¢ Active' : 'ðŸ”´ Inactive' %>
                  </span>
                </p>
                <div class="d-flex gap-2 mb-2">
                  <% if (update.imageUrl) { %>
                    <button class="btn btn-sm btn-outline-primary" onclick="openImage('<%= update.imageUrl %>')">
                      <i class="bi bi-image"></i> View Image
                    </button>
                  <% } %>
                  <% if (update.pdfLink) { %>
                    <a href="<%= update.pdfLink %>" target="_blank" class="btn btn-sm btn-outline-success">
                      <i class="bi bi-file-earmark-pdf"></i> View PDF
                    </a>
                  <% } %>
                </div>
                <div class="mt-auto d-flex flex-wrap gap-1">
                  <a href="/updates/edit/<%= update._id %>" class="btn btn-sm btn-outline-primary">Edit</a>
                  <form action="/updates/toggle/<%= update._id %>" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-sm <%= update.isActive ? 'btn-outline-warning' : 'btn-outline-success' %>">
                      <%= update.isActive ? 'ðŸ”„ Deactivate' : 'ðŸ”„ Activate' %>
                    </button>
                  </form>
                  <form action="/updates/delete/<%= update._id %>" method="POST" onsubmit="return confirm('Delete this update?')" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Image</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img id="modalImage" src="" class="img-fluid" alt="Update Image">
      </div>
    </div>
  </div>
</div>

<script>
function openImage(url) {
  document.getElementById('modalImage').src = url;
  const modal = new bootstrap.Modal(document.getElementById('imageModal'));
  modal.show();
}
</script>

</body>
</html>